<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Parte4-Modelado
  </title>
 </head>
 <body>
  <h1 id="tema-4-modelado-de-datos-con-grafos">
   Tema 4: Modelado de Datos con Grafos
  </h1>
  <div class="toc" id="table-of-contents">
   <h2 id="contents-header">
    Tabla de contenidos
   </h2>
   <ul class="toc">
    <li class="toc">
     <a class="toc" href="#objetivos-de-aprendizaje">
      Objetivos de Aprendizaje
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#41-principios-fundamentales-del-modelado">
      4.1 Principios Fundamentales del Modelado
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#42-patrones-comunes-de-modelado">
      4.2 Patrones Comunes de Modelado
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#43-optimizacion-para-consultas-especificas">
      4.3 Optimización para Consultas Específicas
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#44-ejercicios-practicos-de-modelado">
      4.4 Ejercicios Prácticos de Modelado
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#45-validacion-y-mejores-practicas">
      4.5 Validación y Mejores Prácticas
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#46-resumen-y-preparacion">
      4.6 Resumen y Preparación
     </a>
    </li>
    <li class="toc">
     <a class="toc" href="#47-preparacion-para-el-siguiente-tema">
      4.7 Preparación para el Siguiente Tema
     </a>
    </li>
   </ul>
  </div>
  <div class="chapter-container">
   <h2 id="objetivos-de-aprendizaje">
    Objetivos de Aprendizaje
   </h2>
   <p>
    Al finalizar este tema, los estudiantes serán capaces de:
- Identificar qué elementos deben ser nodos vs relaciones
- Diseñar esquemas de grafos para diferentes dominios
- Implementar patrones comunes de modelado
- Optimizar modelos para consultas específicas
   </p>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="41-principios-fundamentales-del-modelado">
    4.1 Principios Fundamentales del Modelado
   </h2>
   <h3 id="que-debe-ser-un-nodo">
    ¿Qué debe ser un Nodo?
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="c1"># REGLA GENERAL: Los nodos representan ENTIDADES con identidad propia</span>

<span class="c1"># ❌ INCORRECTO: Atributos como nodos</span>
<span class="n">modelo_incorrecto</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'juan_perez'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'persona'</span><span class="p">},</span>
        <span class="s1">'25_años'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'edad'</span><span class="p">},</span>          <span class="c1"># ❌ Edad no es una entidad</span>
        <span class="s1">'madrid'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'ciudad'</span><span class="p">},</span>
        <span class="s1">'ingeniero'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'profesion'</span><span class="p">}</span>    <span class="c1"># ❌ Profesión como nodo genérico</span>
    <span class="p">},</span>
    <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'juan_perez'</span><span class="p">,</span> <span class="s1">'25_años'</span><span class="p">,</span> <span class="s1">'TIENE_EDAD'</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'juan_perez'</span><span class="p">,</span> <span class="s1">'madrid'</span><span class="p">,</span> <span class="s1">'VIVE_EN'</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'juan_perez'</span><span class="p">,</span> <span class="s1">'ingeniero'</span><span class="p">,</span> <span class="s1">'TRABAJA_COMO'</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># ✅ CORRECTO: Solo entidades con identidad como nodos</span>
<span class="n">modelo_correcto</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'juan_perez'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'persona'</span><span class="p">,</span>
            <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>                       <span class="c1"># ✅ Edad como propiedad</span>
            <span class="s1">'profesion'</span><span class="p">:</span> <span class="s1">'ingeniero'</span>          <span class="c1"># ✅ Profesión como propiedad</span>
        <span class="p">},</span>
        <span class="s1">'madrid'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'ciudad'</span><span class="p">,</span>
            <span class="s1">'poblacion'</span><span class="p">:</span> <span class="mi">3200000</span><span class="p">,</span>
            <span class="s1">'pais'</span><span class="p">:</span> <span class="s1">'España'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'juan_perez'</span><span class="p">,</span> <span class="s1">'madrid'</span><span class="p">,</span> <span class="s1">'VIVE_EN'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2020-01-01'</span><span class="p">})</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">validar_modelo</span><span class="p">(</span><span class="n">modelo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Valida si el modelo sigue buenas prácticas"""</span>
    <span class="n">problemas</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">nodo_id</span><span class="p">,</span> <span class="n">propiedades</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Verificar que los nodos tengan identidad propia</span>
        <span class="k">if</span> <span class="s1">'tipo'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">propiedades</span><span class="p">:</span>
            <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodo </span><span class="si">{</span><span class="n">nodo_id</span><span class="si">}</span><span class="s2"> sin tipo definido"</span><span class="p">)</span>

        <span class="c1"># Verificar nombres de nodos descriptivos</span>
        <span class="k">if</span> <span class="n">nodo_id</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodo </span><span class="si">{</span><span class="n">nodo_id</span><span class="si">}</span><span class="s2"> tiene ID numérico poco descriptivo"</span><span class="p">)</span>

    <span class="c1"># Verificar relaciones significativas</span>
    <span class="k">for</span> <span class="n">relacion</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Relación incompleta: </span><span class="si">{</span><span class="n">relacion</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">problemas</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Problemas en modelo incorrecto:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">problema</span> <span class="ow">in</span> <span class="n">validar_modelo</span><span class="p">(</span><span class="n">modelo_incorrecto</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">problema</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Problemas en modelo correcto:"</span><span class="p">)</span>
<span class="n">problemas_correcto</span> <span class="o">=</span> <span class="n">validar_modelo</span><span class="p">(</span><span class="n">modelo_correcto</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">problemas_correcto</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"  - ¡Ningún problema detectado!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">problema</span> <span class="ow">in</span> <span class="n">problemas_correcto</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">problema</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
    </div>
   </div>
   <h3 id="que-debe-ser-una-relacion">
    ¿Qué debe ser una Relación?
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="c1"># REGLA GENERAL: Las relaciones representan INTERACCIONES o ASOCIACIONES</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ejemplos_relaciones</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Ejemplos de cómo modelar diferentes tipos de relaciones"""</span>

    <span class="c1"># 1. RELACIONES SIMPLES: Solo conectan entidades</span>
    <span class="n">relaciones_simples</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'ana'</span><span class="p">,</span> <span class="s1">'carlos'</span><span class="p">,</span> <span class="s1">'AMIGO_DE'</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'carlos'</span><span class="p">,</span> <span class="s1">'empresa_abc'</span><span class="p">,</span> <span class="s1">'TRABAJA_EN'</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'madrid'</span><span class="p">,</span> <span class="s1">'españa'</span><span class="p">,</span> <span class="s1">'UBICADO_EN'</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># 2. RELACIONES CON PROPIEDADES: Información adicional sobre la relación</span>
    <span class="n">relaciones_con_propiedades</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'ana'</span><span class="p">,</span> <span class="s1">'carlos'</span><span class="p">,</span> <span class="s1">'AMIGO_DE'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2020-03-15'</span><span class="p">,</span>
            <span class="s1">'intensidad'</span><span class="p">:</span> <span class="s1">'alta'</span><span class="p">,</span>
            <span class="s1">'como_se_conocieron'</span><span class="p">:</span> <span class="s1">'universidad'</span>
        <span class="p">}),</span>
        <span class="p">(</span><span class="s1">'carlos'</span><span class="p">,</span> <span class="s1">'empresa_abc'</span><span class="p">,</span> <span class="s1">'TRABAJA_EN'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'desarrollador senior'</span><span class="p">,</span>
            <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2022-01-01'</span><span class="p">,</span>
            <span class="s1">'salario'</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s1">'modalidad'</span><span class="p">:</span> <span class="s1">'remoto'</span>
        <span class="p">})</span>
    <span class="p">]</span>

    <span class="c1"># 3. RELACIONES TEMPORALES: Que cambian en el tiempo</span>
    <span class="n">relaciones_temporales</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'pedro'</span><span class="p">,</span> <span class="s1">'universidad_madrid'</span><span class="p">,</span> <span class="s1">'ESTUDIO_EN'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2018-09-01'</span><span class="p">,</span>
            <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2022-06-30'</span><span class="p">,</span>
            <span class="s1">'titulo'</span><span class="p">:</span> <span class="s1">'Ingeniería Informática'</span><span class="p">,</span>
            <span class="s1">'nota_media'</span><span class="p">:</span> <span class="mf">8.5</span>
        <span class="p">}),</span>
        <span class="p">(</span><span class="s1">'lucia'</span><span class="p">,</span> <span class="s1">'empresa_xyz'</span><span class="p">,</span> <span class="s1">'TRABAJO_EN'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2020-01-15'</span><span class="p">,</span>
            <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2023-12-31'</span><span class="p">,</span>
            <span class="s1">'motivo_salida'</span><span class="p">:</span> <span class="s1">'mejor_oportunidad'</span>
        <span class="p">})</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">'simples'</span><span class="p">:</span> <span class="n">relaciones_simples</span><span class="p">,</span>
        <span class="s1">'con_propiedades'</span><span class="p">:</span> <span class="n">relaciones_con_propiedades</span><span class="p">,</span>
        <span class="s1">'temporales'</span><span class="p">:</span> <span class="n">relaciones_temporales</span>
    <span class="p">}</span>

<span class="c1"># Ejemplo práctico: Sistema de gestión académica</span>
<span class="n">sistema_academico</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Estudiantes</span>
        <span class="s1">'ana_garcia'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'estudiante'</span><span class="p">,</span>
            <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">'email'</span><span class="p">:</span> <span class="s1">'ana.garcia@universidad.edu'</span>
        <span class="p">},</span>
        <span class="s1">'carlos_lopez'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'estudiante'</span><span class="p">,</span>
            <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
            <span class="s1">'email'</span><span class="p">:</span> <span class="s1">'carlos.lopez@universidad.edu'</span>
        <span class="p">},</span>

        <span class="c1"># Profesores</span>
        <span class="s1">'prof_martinez'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'profesor'</span><span class="p">,</span>
            <span class="s1">'departamento'</span><span class="p">:</span> <span class="s1">'Informática'</span><span class="p">,</span>
            <span class="s1">'años_experiencia'</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>

        <span class="c1"># Cursos</span>
        <span class="s1">'algoritmos_2024'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'curso'</span><span class="p">,</span>
            <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Algoritmos y Estructuras de Datos'</span><span class="p">,</span>
            <span class="s1">'creditos'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s1">'semestre'</span><span class="p">:</span> <span class="s1">'2024-1'</span>
        <span class="p">},</span>
        <span class="s1">'bases_datos_2024'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'curso'</span><span class="p">,</span>
            <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Bases de Datos'</span><span class="p">,</span>
            <span class="s1">'creditos'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">'semestre'</span><span class="p">:</span> <span class="s1">'2024-1'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># Inscripciones de estudiantes</span>
        <span class="p">(</span><span class="s1">'ana_garcia'</span><span class="p">,</span> <span class="s1">'algoritmos_2024'</span><span class="p">,</span> <span class="s1">'INSCRITO_EN'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'fecha_inscripcion'</span><span class="p">:</span> <span class="s1">'2024-01-15'</span><span class="p">,</span>
            <span class="s1">'nota_final'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Aún no terminado</span>
            <span class="s1">'asistencia'</span><span class="p">:</span> <span class="mf">0.95</span>
        <span class="p">}),</span>
        <span class="p">(</span><span class="s1">'carlos_lopez'</span><span class="p">,</span> <span class="s1">'algoritmos_2024'</span><span class="p">,</span> <span class="s1">'INSCRITO_EN'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'fecha_inscripcion'</span><span class="p">:</span> <span class="s1">'2024-01-10'</span><span class="p">,</span>
            <span class="s1">'nota_final'</span><span class="p">:</span> <span class="mf">8.5</span><span class="p">,</span>
            <span class="s1">'asistencia'</span><span class="p">:</span> <span class="mf">0.88</span>
        <span class="p">}),</span>

        <span class="c1"># Profesores que dictan cursos</span>
        <span class="p">(</span><span class="s1">'prof_martinez'</span><span class="p">,</span> <span class="s1">'algoritmos_2024'</span><span class="p">,</span> <span class="s1">'DICTA'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'horario'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'lunes 10:00-12:00'</span><span class="p">,</span> <span class="s1">'miércoles 14:00-16:00'</span><span class="p">],</span>
            <span class="s1">'aula'</span><span class="p">:</span> <span class="s1">'Lab-203'</span>
        <span class="p">}),</span>
        <span class="p">(</span><span class="s1">'prof_martinez'</span><span class="p">,</span> <span class="s1">'bases_datos_2024'</span><span class="p">,</span> <span class="s1">'DICTA'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'horario'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'martes 08:00-10:00'</span><span class="p">],</span>
            <span class="s1">'aula'</span><span class="p">:</span> <span class="s1">'Aula-305'</span>
        <span class="p">})</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">consultas_academicas</span><span class="p">(</span><span class="n">sistema</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Ejemplos de consultas típicas en el sistema académico"""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">estudiantes_de_curso</span><span class="p">(</span><span class="n">curso_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra todos los estudiantes inscritos en un curso"""</span>
        <span class="n">estudiantes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">sistema</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">curso_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'INSCRITO_EN'</span><span class="p">:</span>
                <span class="n">estudiante_info</span> <span class="o">=</span> <span class="n">sistema</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">estudiante_info</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Tiene propiedades</span>
                    <span class="n">estudiante_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">estudiantes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estudiante_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">estudiantes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cursos_de_profesor</span><span class="p">(</span><span class="n">profesor_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra todos los cursos que dicta un profesor"""</span>
        <span class="n">cursos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">sistema</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">profesor_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'DICTA'</span><span class="p">:</span>
                <span class="n">curso_info</span> <span class="o">=</span> <span class="n">sistema</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">curso_info</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">curso_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">cursos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curso_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cursos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">promedio_curso</span><span class="p">(</span><span class="n">curso_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Calcula el promedio de notas de un curso"""</span>
        <span class="n">notas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">sistema</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">curso_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'INSCRITO_EN'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'nota_final'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">notas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'nota_final'</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">notas</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">notas</span><span class="p">)</span> <span class="k">if</span> <span class="n">notas</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Ejecutar consultas de ejemplo</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Estudiantes en Algoritmos 2024:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">estudiante</span> <span class="ow">in</span> <span class="n">estudiantes_de_curso</span><span class="p">(</span><span class="s1">'algoritmos_2024'</span><span class="p">):</span>
        <span class="n">nota</span> <span class="o">=</span> <span class="n">estudiante</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'nota_final'</span><span class="p">,</span> <span class="s1">'En progreso'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">estudiante</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">nota</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Cursos del Prof. Martínez:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">curso</span> <span class="ow">in</span> <span class="n">cursos_de_profesor</span><span class="p">(</span><span class="s1">'prof_martinez'</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">curso</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">curso</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="n">promedio</span> <span class="o">=</span> <span class="n">promedio_curso</span><span class="p">(</span><span class="s1">'algoritmos_2024'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Promedio en Algoritmos 2024: </span><span class="si">{</span><span class="n">promedio</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">promedio</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Sin notas finales'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">consultas_academicas</span><span class="p">(</span><span class="n">sistema_academico</span><span class="p">)</span>
</pre>
    </div>
   </div>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="42-patrones-comunes-de-modelado">
    4.2 Patrones Comunes de Modelado
   </h2>
   <h3 id="patron-1-relaciones-jerarquicas-arboles">
    Patrón 1: Relaciones Jerárquicas (Árboles)
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">modelar_jerarquia_empresarial</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Modela la estructura organizacional de una empresa"""</span>

    <span class="n">empresa</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'empleados'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'ceo_ana'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Ana Rodríguez'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'CEO'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="s1">'cto_carlos'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Carlos Mendoza'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'CTO'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">},</span>
            <span class="s1">'cfo_lucia'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Lucía Santos'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'CFO'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">},</span>
            <span class="s1">'dev_senior_pedro'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Pedro García'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Senior Developer'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">3</span>
            <span class="p">},</span>
            <span class="s1">'dev_junior_sofia'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Sofía Martín'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Junior Developer'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">4</span>
            <span class="p">},</span>
            <span class="s1">'contador_miguel'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empleado'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Miguel López'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Contador'</span><span class="p">,</span>
                <span class="s1">'nivel'</span><span class="p">:</span> <span class="mi">3</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Estructura jerárquica</span>
            <span class="p">(</span><span class="s1">'ceo_ana'</span><span class="p">,</span> <span class="s1">'cto_carlos'</span><span class="p">,</span> <span class="s1">'SUPERVISA'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'ceo_ana'</span><span class="p">,</span> <span class="s1">'cfo_lucia'</span><span class="p">,</span> <span class="s1">'SUPERVISA'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'cto_carlos'</span><span class="p">,</span> <span class="s1">'dev_senior_pedro'</span><span class="p">,</span> <span class="s1">'SUPERVISA'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'dev_senior_pedro'</span><span class="p">,</span> <span class="s1">'dev_junior_sofia'</span><span class="p">,</span> <span class="s1">'SUPERVISA'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'cfo_lucia'</span><span class="p">,</span> <span class="s1">'contador_miguel'</span><span class="p">,</span> <span class="s1">'SUPERVISA'</span><span class="p">),</span>

            <span class="c1"># Relaciones de colaboración</span>
            <span class="p">(</span><span class="s1">'dev_senior_pedro'</span><span class="p">,</span> <span class="s1">'contador_miguel'</span><span class="p">,</span> <span class="s1">'COLABORA_CON'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'cto_carlos'</span><span class="p">,</span> <span class="s1">'cfo_lucia'</span><span class="p">,</span> <span class="s1">'COORDINA_CON'</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encontrar_subordinados</span><span class="p">(</span><span class="n">jefe_id</span><span class="p">,</span> <span class="n">empresa</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra todos los subordinados de un jefe (directos e indirectos)"""</span>
        <span class="n">subordinados_directos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">jefe_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'SUPERVISA'</span><span class="p">:</span>
                <span class="n">subordinados_directos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">todos_subordinados</span> <span class="o">=</span> <span class="n">subordinados_directos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">subordinado</span> <span class="ow">in</span> <span class="n">subordinados_directos</span><span class="p">:</span>
            <span class="n">todos_subordinados</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">encontrar_subordinados</span><span class="p">(</span><span class="n">subordinado</span><span class="p">,</span> <span class="n">empresa</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">todos_subordinados</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encontrar_jefe</span><span class="p">(</span><span class="n">empleado_id</span><span class="p">,</span> <span class="n">empresa</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra el jefe directo de un empleado"""</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">empleado_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'SUPERVISA'</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_profundidad_jerarquica</span><span class="p">(</span><span class="n">empresa</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Calcula la profundidad de la jerarquía organizacional"""</span>
        <span class="n">niveles</span> <span class="o">=</span> <span class="p">[</span><span class="n">emp</span><span class="p">[</span><span class="s1">'nivel'</span><span class="p">]</span> <span class="k">for</span> <span class="n">emp</span> <span class="ow">in</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'empleados'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">niveles</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">niveles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Análisis de la estructura</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Análisis de Jerarquía Empresarial:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"=================================="</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Subordinados del CTO:"</span><span class="p">)</span>
    <span class="n">subordinados_cto</span> <span class="o">=</span> <span class="n">encontrar_subordinados</span><span class="p">(</span><span class="s1">'cto_carlos'</span><span class="p">,</span> <span class="n">empresa</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sub_id</span> <span class="ow">in</span> <span class="n">subordinados_cto</span><span class="p">:</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'empleados'</span><span class="p">][</span><span class="n">sub_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="n">posicion</span> <span class="o">=</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'empleados'</span><span class="p">][</span><span class="n">sub_id</span><span class="p">][</span><span class="s1">'posicion'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">posicion</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Jefe de Pedro García:"</span><span class="p">)</span>
    <span class="n">jefe_pedro</span> <span class="o">=</span> <span class="n">encontrar_jefe</span><span class="p">(</span><span class="s1">'dev_senior_pedro'</span><span class="p">,</span> <span class="n">empresa</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">jefe_pedro</span><span class="p">:</span>
        <span class="n">jefe_info</span> <span class="o">=</span> <span class="n">empresa</span><span class="p">[</span><span class="s1">'empleados'</span><span class="p">][</span><span class="n">jefe_pedro</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">jefe_info</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">jefe_info</span><span class="p">[</span><span class="s1">'posicion'</span><span class="p">]</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Profundidad jerárquica: </span><span class="si">{</span><span class="n">calcular_profundidad_jerarquica</span><span class="p">(</span><span class="n">empresa</span><span class="p">)</span><span class="si">}</span><span class="s2"> niveles"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">empresa</span>

<span class="n">empresa_modelo</span> <span class="o">=</span> <span class="n">modelar_jerarquia_empresarial</span><span class="p">()</span>
</pre>
    </div>
   </div>
   <h3 id="patron-2-relaciones-muchos-a-muchos">
    Patrón 2: Relaciones Muchos a Muchos
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">modelar_red_social_compleja</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Modela una red social con múltiples tipos de relaciones"""</span>

    <span class="n">red_social</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'usuarios'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'ana_25'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Ana García'</span><span class="p">,</span>
                <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="s1">'intereses'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'tecnología'</span><span class="p">,</span> <span class="s1">'viajes'</span><span class="p">,</span> <span class="s1">'fotografía'</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">'carlos_30'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span> 
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Carlos López'</span><span class="p">,</span>
                <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s1">'intereses'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'deportes'</span><span class="p">,</span> <span class="s1">'música'</span><span class="p">,</span> <span class="s1">'tecnología'</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">'lucia_28'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Lucía Martín'</span><span class="p">,</span>
                <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
                <span class="s1">'intereses'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'arte'</span><span class="p">,</span> <span class="s1">'literatura'</span><span class="p">,</span> <span class="s1">'viajes'</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">'pedro_32'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Pedro Santos'</span><span class="p">,</span>
                <span class="s1">'edad'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="s1">'intereses'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'deportes'</span><span class="p">,</span> <span class="s1">'negocios'</span><span class="p">,</span> <span class="s1">'tecnología'</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'grupos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'grupo_tech'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'grupo'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Entusiastas de la Tecnología'</span><span class="p">,</span>
                <span class="s1">'categoria'</span><span class="p">:</span> <span class="s1">'tecnología'</span><span class="p">,</span>
                <span class="s1">'miembros_count'</span><span class="p">:</span> <span class="mi">4</span>
            <span class="p">},</span>
            <span class="s1">'grupo_viajes'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'grupo'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Viajeros del Mundo'</span><span class="p">,</span>
                <span class="s1">'categoria'</span><span class="p">:</span> <span class="s1">'viajes'</span><span class="p">,</span>
                <span class="s1">'miembros_count'</span><span class="p">:</span> <span class="mi">2</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'eventos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'evento_tech_2024'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'evento'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'TechConf 2024'</span><span class="p">,</span>
                <span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-03-15'</span><span class="p">,</span>
                <span class="s1">'ubicacion'</span><span class="p">:</span> <span class="s1">'Madrid'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Amistades (simétricas)</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'carlos_30'</span><span class="p">,</span> <span class="s1">'AMIGO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2022-01-15'</span><span class="p">,</span> <span class="s1">'fuerza'</span><span class="p">:</span> <span class="s1">'alta'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'lucia_28'</span><span class="p">,</span> <span class="s1">'AMIGO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2023-06-10'</span><span class="p">,</span> <span class="s1">'fuerza'</span><span class="p">:</span> <span class="s1">'media'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'carlos_30'</span><span class="p">,</span> <span class="s1">'pedro_32'</span><span class="p">,</span> <span class="s1">'AMIGO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2021-09-20'</span><span class="p">,</span> <span class="s1">'fuerza'</span><span class="p">:</span> <span class="s1">'alta'</span><span class="p">}),</span>

            <span class="c1"># Pertenencia a grupos</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'grupo_tech'</span><span class="p">,</span> <span class="s1">'MIEMBRO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'admin'</span><span class="p">,</span> <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2023-01-01'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'carlos_30'</span><span class="p">,</span> <span class="s1">'grupo_tech'</span><span class="p">,</span> <span class="s1">'MIEMBRO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'miembro'</span><span class="p">,</span> <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2023-02-15'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'grupo_viajes'</span><span class="p">,</span> <span class="s1">'MIEMBRO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'miembro'</span><span class="p">,</span> <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2023-05-01'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'lucia_28'</span><span class="p">,</span> <span class="s1">'grupo_viajes'</span><span class="p">,</span> <span class="s1">'MIEMBRO_DE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'miembro'</span><span class="p">,</span> <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2023-05-10'</span><span class="p">}),</span>

            <span class="c1"># Asistencia a eventos</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'evento_tech_2024'</span><span class="p">,</span> <span class="s1">'ASISTIRA_A'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'confirmado'</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'carlos_30'</span><span class="p">,</span> <span class="s1">'evento_tech_2024'</span><span class="p">,</span> <span class="s1">'ASISTIRA_A'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'confirmado'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'pedro_32'</span><span class="p">,</span> <span class="s1">'evento_tech_2024'</span><span class="p">,</span> <span class="s1">'ASISTIRA_A'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'confirmado'</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>

            <span class="c1"># Interacciones</span>
            <span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'carlos_30'</span><span class="p">,</span> <span class="s1">'MENCIONO'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-01-20'</span><span class="p">,</span> <span class="s1">'contexto'</span><span class="p">:</span> <span class="s1">'post_tech'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'lucia_28'</span><span class="p">,</span> <span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'COMENTO_POST'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-01-22'</span><span class="p">,</span> <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'like'</span><span class="p">})</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encontrar_amigos_comunes</span><span class="p">(</span><span class="n">usuario1</span><span class="p">,</span> <span class="n">usuario2</span><span class="p">,</span> <span class="n">red</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra amigos en común entre dos usuarios"""</span>
        <span class="n">amigos_u1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">amigos_u2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'AMIGO_DE'</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario1</span><span class="p">:</span>
                    <span class="n">amigos_u1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario1</span><span class="p">:</span>
                    <span class="n">amigos_u1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario2</span><span class="p">:</span>
                    <span class="n">amigos_u2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario2</span><span class="p">:</span>
                    <span class="n">amigos_u2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">amigos_u1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">amigos_u2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sugerir_amigos</span><span class="p">(</span><span class="n">usuario_id</span><span class="p">,</span> <span class="n">red</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Sugiere nuevos amigos basado en amigos comunes y grupos"""</span>
        <span class="n">amigos_actuales</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">grupos_usuario</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Obtener amigos actuales y grupos del usuario</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'AMIGO_DE'</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario_id</span><span class="p">:</span>
                    <span class="n">amigos_actuales</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario_id</span><span class="p">:</span>
                    <span class="n">amigos_actuales</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'MIEMBRO_DE'</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario_id</span><span class="p">:</span>
                <span class="n">grupos_usuario</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">candidatos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Buscar miembros de los mismos grupos</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'MIEMBRO_DE'</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">grupos_usuario</span><span class="p">:</span>
                <span class="n">candidato</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">candidato</span> <span class="o">!=</span> <span class="n">usuario_id</span> <span class="ow">and</span> <span class="n">candidato</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">amigos_actuales</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">candidato</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidatos</span><span class="p">:</span>
                        <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'puntos'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'razones'</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">][</span><span class="s1">'puntos'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">][</span><span class="s1">'razones'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mismo grupo: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Buscar amigos de amigos</span>
        <span class="k">for</span> <span class="n">amigo</span> <span class="ow">in</span> <span class="n">amigos_actuales</span><span class="p">:</span>
            <span class="n">amigos_del_amigo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'AMIGO_DE'</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">amigo</span><span class="p">:</span>
                        <span class="n">amigos_del_amigo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">amigo</span><span class="p">:</span>
                        <span class="n">amigos_del_amigo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">candidato</span> <span class="ow">in</span> <span class="n">amigos_del_amigo</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">candidato</span> <span class="o">!=</span> <span class="n">usuario_id</span> <span class="ow">and</span> <span class="n">candidato</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">amigos_actuales</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">candidato</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidatos</span><span class="p">:</span>
                        <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'puntos'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'razones'</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">][</span><span class="s1">'puntos'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">candidatos</span><span class="p">[</span><span class="n">candidato</span><span class="p">][</span><span class="s1">'razones'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Amigo de </span><span class="si">{</span><span class="n">amigo</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Ordenar por puntuación</span>
        <span class="n">sugerencias</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidatos</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'puntos'</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sugerencias</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Top 3 sugerencias</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analizar_actividad_grupos</span><span class="p">(</span><span class="n">red</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Analiza la actividad en grupos"""</span>
        <span class="n">actividad_grupos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">grupo_id</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'grupos'</span><span class="p">]:</span>
            <span class="n">actividad_grupos</span><span class="p">[</span><span class="n">grupo_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">'miembros'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">'admins'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">'miembros_activos'</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">red</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'MIEMBRO_DE'</span><span class="p">:</span>
                <span class="n">grupo_id</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">actividad_grupos</span><span class="p">[</span><span class="n">grupo_id</span><span class="p">][</span><span class="s1">'miembros'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'rol'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'admin'</span><span class="p">:</span>
                    <span class="n">actividad_grupos</span><span class="p">[</span><span class="n">grupo_id</span><span class="p">][</span><span class="s1">'admins'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">actividad_grupos</span>

    <span class="c1"># Análisis de la red social</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Análisis de Red Social:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"======================"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Amigos comunes entre Ana y Carlos:"</span><span class="p">)</span>
    <span class="n">comunes</span> <span class="o">=</span> <span class="n">encontrar_amigos_comunes</span><span class="p">(</span><span class="s1">'ana_25'</span><span class="p">,</span> <span class="s1">'carlos_30'</span><span class="p">,</span> <span class="n">red_social</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">amigo_id</span> <span class="ow">in</span> <span class="n">comunes</span><span class="p">:</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">red_social</span><span class="p">[</span><span class="s1">'usuarios'</span><span class="p">][</span><span class="n">amigo_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Sugerencias de amistad para Lucía:"</span><span class="p">)</span>
    <span class="n">sugerencias</span> <span class="o">=</span> <span class="n">sugerir_amigos</span><span class="p">(</span><span class="s1">'lucia_28'</span><span class="p">,</span> <span class="n">red_social</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">candidato_id</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">sugerencias</span><span class="p">:</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">red_social</span><span class="p">[</span><span class="s1">'usuarios'</span><span class="p">][</span><span class="n">candidato_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'puntos'</span><span class="p">]</span><span class="si">}</span><span class="s2"> puntos)"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">razon</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">'razones'</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"    • </span><span class="si">{</span><span class="n">razon</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Actividad en grupos:"</span><span class="p">)</span>
    <span class="n">actividad</span> <span class="o">=</span> <span class="n">analizar_actividad_grupos</span><span class="p">(</span><span class="n">red_social</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">grupo_id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">actividad</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nombre_grupo</span> <span class="o">=</span> <span class="n">red_social</span><span class="p">[</span><span class="s1">'grupos'</span><span class="p">][</span><span class="n">grupo_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  - </span><span class="si">{</span><span class="n">nombre_grupo</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'miembros'</span><span class="p">]</span><span class="si">}</span><span class="s2"> miembros, </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">'admins'</span><span class="p">]</span><span class="si">}</span><span class="s2"> admins"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">red_social</span>

<span class="n">red_social_modelo</span> <span class="o">=</span> <span class="n">modelar_red_social_compleja</span><span class="p">()</span>
</pre>
    </div>
   </div>
   <h3 id="patron-3-relaciones-temporales">
    Patrón 3: Relaciones Temporales
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">modelar_historial_laboral</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Modela el historial laboral con relaciones temporales"""</span>

    <span class="n">historial</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'personas'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'ana_dev'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'persona'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Ana García'</span><span class="p">,</span>
                <span class="s1">'profesion'</span><span class="p">:</span> <span class="s1">'Desarrolladora'</span><span class="p">,</span>
                <span class="s1">'skills'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Python'</span><span class="p">,</span> <span class="s1">'JavaScript'</span><span class="p">,</span> <span class="s1">'React'</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">'carlos_pm'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'persona'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Carlos López'</span><span class="p">,</span> 
                <span class="s1">'profesion'</span><span class="p">:</span> <span class="s1">'Project Manager'</span><span class="p">,</span>
                <span class="s1">'skills'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Scrum'</span><span class="p">,</span> <span class="s1">'Agile'</span><span class="p">,</span> <span class="s1">'Leadership'</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'empresas'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'startup_tech'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empresa'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'TechStartup SL'</span><span class="p">,</span>
                <span class="s1">'sector'</span><span class="p">:</span> <span class="s1">'Tecnología'</span><span class="p">,</span>
                <span class="s1">'tamaño'</span><span class="p">:</span> <span class="s1">'pequeña'</span>
            <span class="p">},</span>
            <span class="s1">'corporacion_big'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empresa'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'BigCorp SA'</span><span class="p">,</span>
                <span class="s1">'sector'</span><span class="p">:</span> <span class="s1">'Consultoría'</span><span class="p">,</span>
                <span class="s1">'tamaño'</span><span class="p">:</span> <span class="s1">'grande'</span>
            <span class="p">},</span>
            <span class="s1">'empresa_media'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'empresa'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'MediumTech SL'</span><span class="p">,</span>
                <span class="s1">'sector'</span><span class="p">:</span> <span class="s1">'Software'</span><span class="p">,</span>
                <span class="s1">'tamaño'</span><span class="p">:</span> <span class="s1">'mediana'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'proyectos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'proyecto_web'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'proyecto'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Plataforma E-commerce'</span><span class="p">,</span>
                <span class="s1">'estado'</span><span class="p">:</span> <span class="s1">'completado'</span><span class="p">,</span>
                <span class="s1">'tecnologias'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'React'</span><span class="p">,</span> <span class="s1">'Node.js'</span><span class="p">,</span> <span class="s1">'MongoDB'</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">'proyecto_mobile'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'proyecto'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'App Móvil Bancaria'</span><span class="p">,</span>
                <span class="s1">'estado'</span><span class="p">:</span> <span class="s1">'en_desarrollo'</span><span class="p">,</span>
                <span class="s1">'tecnologias'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'React Native'</span><span class="p">,</span> <span class="s1">'Firebase'</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Historial laboral de Ana</span>
            <span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'startup_tech'</span><span class="p">,</span> <span class="s1">'TRABAJO_EN'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2020-01-15'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2022-06-30'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Junior Developer'</span><span class="p">,</span>
                <span class="s1">'salario_inicial'</span><span class="p">:</span> <span class="mi">28000</span><span class="p">,</span>
                <span class="s1">'salario_final'</span><span class="p">:</span> <span class="mi">32000</span><span class="p">,</span>
                <span class="s1">'motivo_salida'</span><span class="p">:</span> <span class="s1">'crecimiento_profesional'</span>
            <span class="p">}),</span>
            <span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'empresa_media'</span><span class="p">,</span> <span class="s1">'TRABAJO_EN'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2022-07-01'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2024-01-31'</span><span class="p">,</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Senior Developer'</span><span class="p">,</span>
                <span class="s1">'salario_inicial'</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
                <span class="s1">'salario_final'</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
                <span class="s1">'motivo_salida'</span><span class="p">:</span> <span class="s1">'mejor_oportunidad'</span>
            <span class="p">}),</span>
            <span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'corporacion_big'</span><span class="p">,</span> <span class="s1">'TRABAJA_EN'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2024-02-01'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Empleo actual</span>
                <span class="s1">'posicion'</span><span class="p">:</span> <span class="s1">'Tech Lead'</span><span class="p">,</span>
                <span class="s1">'salario_inicial'</span><span class="p">:</span> <span class="mi">65000</span><span class="p">,</span>
                <span class="s1">'modalidad'</span><span class="p">:</span> <span class="s1">'hibrido'</span>
            <span class="p">}),</span>

            <span class="c1"># Participación en proyectos</span>
            <span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'proyecto_web'</span><span class="p">,</span> <span class="s1">'PARTICIPO_EN'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2021-03-01'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2021-12-15'</span><span class="p">,</span>
                <span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'Frontend Developer'</span><span class="p">,</span>
                <span class="s1">'contribucion'</span><span class="p">:</span> <span class="s1">'alta'</span>
            <span class="p">}),</span>
            <span class="p">(</span><span class="s1">'carlos_pm'</span><span class="p">,</span> <span class="s1">'proyecto_web'</span><span class="p">,</span> <span class="s1">'LIDERO'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2021-02-15'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="s1">'2021-12-31'</span><span class="p">,</span>
                <span class="s1">'metodologia'</span><span class="p">:</span> <span class="s1">'Scrum'</span><span class="p">,</span>
                <span class="s1">'equipo_tamaño'</span><span class="p">:</span> <span class="mi">5</span>
            <span class="p">}),</span>
            <span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'proyecto_mobile'</span><span class="p">,</span> <span class="s1">'PARTICIPA_EN'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'desde'</span><span class="p">:</span> <span class="s1">'2024-03-01'</span><span class="p">,</span>
                <span class="s1">'hasta'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Proyecto actual</span>
                <span class="s1">'rol'</span><span class="p">:</span> <span class="s1">'Tech Lead'</span><span class="p">,</span>
                <span class="s1">'responsabilidades'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'arquitectura'</span><span class="p">,</span> <span class="s1">'mentoring'</span><span class="p">]</span>
            <span class="p">})</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_experiencia_total</span><span class="p">(</span><span class="n">persona_id</span><span class="p">,</span> <span class="n">historial</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Calcula la experiencia total en años"""</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

        <span class="n">experiencia_total</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">historial</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona_id</span> <span class="ow">and</span> <span class="s1">'TRABAJO'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">'desde'</span><span class="p">],</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'hasta'</span><span class="p">):</span>
                    <span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">'hasta'</span><span class="p">],</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1"># Trabajo actual</span>

                <span class="n">experiencia_total</span> <span class="o">+=</span> <span class="n">fecha_fin</span> <span class="o">-</span> <span class="n">fecha_inicio</span>

        <span class="n">años_experiencia</span> <span class="o">=</span> <span class="n">experiencia_total</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.25</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">años_experiencia</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analizar_progresion_salarial</span><span class="p">(</span><span class="n">persona_id</span><span class="p">,</span> <span class="n">historial</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Analiza la progresión salarial de una persona"""</span>
        <span class="n">empleos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">historial</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona_id</span> <span class="ow">and</span> <span class="s1">'TRABAJO'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">empleo_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">'empresa'</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">'desde'</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'desde'</span><span class="p">],</span>
                    <span class="s1">'hasta'</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'hasta'</span><span class="p">,</span> <span class="s1">'Actual'</span><span class="p">),</span>
                    <span class="s1">'posicion'</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'posicion'</span><span class="p">],</span>
                    <span class="s1">'salario_inicial'</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'salario_inicial'</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="s1">'salario_final'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">empleo_info</span><span class="p">[</span><span class="s1">'salario_final'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'salario_final'</span><span class="p">]</span>
                <span class="n">empleos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empleo_info</span><span class="p">)</span>

        <span class="c1"># Ordenar por fecha</span>
        <span class="n">empleos</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'desde'</span><span class="p">])</span>

        <span class="c1"># Calcular crecimiento</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empleos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">salario_inicial</span> <span class="o">=</span> <span class="n">empleos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'salario_inicial'</span><span class="p">]</span>
            <span class="n">salario_actual</span> <span class="o">=</span> <span class="n">empleos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'salario_final'</span><span class="p">,</span> <span class="n">empleos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'salario_inicial'</span><span class="p">])</span>
            <span class="n">crecimiento</span> <span class="o">=</span> <span class="p">((</span><span class="n">salario_actual</span> <span class="o">-</span> <span class="n">salario_inicial</span><span class="p">)</span> <span class="o">/</span> <span class="n">salario_inicial</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">crecimiento</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">empleos</span><span class="p">,</span> <span class="n">crecimiento</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encontrar_colaboradores_comunes</span><span class="p">(</span><span class="n">persona1</span><span class="p">,</span> <span class="n">persona2</span><span class="p">,</span> <span class="n">historial</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Encuentra proyectos donde colaboraron dos personas"""</span>
        <span class="n">proyectos_p1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">proyectos_p2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">historial</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">'PROYECTO'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">'PARTICIP'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">'LIDERO'</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona1</span><span class="p">:</span>
                    <span class="n">proyectos_p1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona2</span><span class="p">:</span>
                    <span class="n">proyectos_p2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">proyectos_comunes</span> <span class="o">=</span> <span class="n">proyectos_p1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">proyectos_p2</span><span class="p">)</span>

        <span class="n">colaboraciones</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">proyecto_id</span> <span class="ow">in</span> <span class="n">proyectos_comunes</span><span class="p">:</span>
            <span class="n">info_p1</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">info_p2</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">historial</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">proyecto_id</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona1</span><span class="p">:</span>
                        <span class="n">info_p1</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">persona2</span><span class="p">:</span>
                        <span class="n">info_p2</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">info_p1</span> <span class="ow">and</span> <span class="n">info_p2</span><span class="p">:</span>
                <span class="n">colaboraciones</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">'proyecto'</span><span class="p">:</span> <span class="n">proyecto_id</span><span class="p">,</span>
                    <span class="s1">'rol_p1'</span><span class="p">:</span> <span class="n">info_p1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'rol'</span><span class="p">,</span> <span class="s1">'N/A'</span><span class="p">),</span>
                    <span class="s1">'rol_p2'</span><span class="p">:</span> <span class="n">info_p2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'rol'</span><span class="p">,</span> <span class="s1">'N/A'</span><span class="p">),</span>
                    <span class="s1">'periodo'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">info_p1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'desde'</span><span class="p">,</span><span class="w"> </span><span class="s1">'N/A'</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">info_p1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'hasta'</span><span class="p">,</span><span class="w"> </span><span class="s1">'N/A'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">colaboraciones</span>

    <span class="c1"># Análisis del historial laboral</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Análisis de Historial Laboral:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"=============================="</span><span class="p">)</span>

    <span class="n">exp_ana</span> <span class="o">=</span> <span class="n">calcular_experiencia_total</span><span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="n">historial</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Experiencia total de Ana: </span><span class="si">{</span><span class="n">exp_ana</span><span class="si">}</span><span class="s2"> años"</span><span class="p">)</span>

    <span class="n">empleos_ana</span><span class="p">,</span> <span class="n">crecimiento_ana</span> <span class="o">=</span> <span class="n">analizar_progresion_salarial</span><span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="n">historial</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Progresión salarial de Ana:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">empleo</span> <span class="ow">in</span> <span class="n">empleos_ana</span><span class="p">:</span>
        <span class="n">salario_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"€</span><span class="si">{</span><span class="n">empleo</span><span class="p">[</span><span class="s1">'salario_inicial'</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">if</span> <span class="s1">'salario_final'</span> <span class="ow">in</span> <span class="n">empleo</span><span class="p">:</span>
            <span class="n">salario_info</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">" → €</span><span class="si">{</span><span class="n">empleo</span><span class="p">[</span><span class="s1">'salario_final'</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  • </span><span class="si">{</span><span class="n">empleo</span><span class="p">[</span><span class="s1">'posicion'</span><span class="p">]</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">empleo</span><span class="p">[</span><span class="s1">'empresa'</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">salario_info</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Crecimiento salarial total: </span><span class="si">{</span><span class="n">crecimiento_ana</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>

    <span class="n">colaboraciones</span> <span class="o">=</span> <span class="n">encontrar_colaboradores_comunes</span><span class="p">(</span><span class="s1">'ana_dev'</span><span class="p">,</span> <span class="s1">'carlos_pm'</span><span class="p">,</span> <span class="n">historial</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Colaboraciones entre Ana y Carlos:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">colab</span> <span class="ow">in</span> <span class="n">colaboraciones</span><span class="p">:</span>
        <span class="n">proyecto_nombre</span> <span class="o">=</span> <span class="n">historial</span><span class="p">[</span><span class="s1">'proyectos'</span><span class="p">][</span><span class="n">colab</span><span class="p">[</span><span class="s1">'proyecto'</span><span class="p">]][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  • </span><span class="si">{</span><span class="n">proyecto_nombre</span><span class="si">}</span><span class="s2">: Ana como </span><span class="si">{</span><span class="n">colab</span><span class="p">[</span><span class="s1">'rol_p1'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Carlos como </span><span class="si">{</span><span class="n">colab</span><span class="p">[</span><span class="s1">'rol_p2'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">historial</span>

<span class="n">historial_modelo</span> <span class="o">=</span> <span class="n">modelar_historial_laboral</span><span class="p">()</span>
</pre>
    </div>
   </div>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="43-optimizacion-para-consultas-especificas">
    4.3 Optimización para Consultas Específicas
   </h2>
   <h3 id="modelado-orientado-a-consultas">
    Modelado Orientado a Consultas
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">optimizar_para_consultas</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Demuestra cómo optimizar el modelo según las consultas más frecuentes"""</span>

    <span class="c1"># CASO: Sistema de e-commerce</span>
    <span class="c1"># Consultas más frecuentes:</span>
    <span class="c1"># 1. "Productos que compró el usuario X"</span>
    <span class="c1"># 2. "Usuarios que compraron el producto Y" </span>
    <span class="c1"># 3. "Productos relacionados/recomendados"</span>
    <span class="c1"># 4. "Historial de pedidos del usuario"</span>

    <span class="c1"># ❌ MODELO SUBÓPTIMO: Todo como propiedades</span>
    <span class="n">modelo_suboptimo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'pedido_001'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'pedido'</span><span class="p">,</span>
                <span class="s1">'usuario'</span><span class="p">:</span> <span class="s1">'ana_garcia'</span><span class="p">,</span>
                <span class="s1">'productos'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'laptop'</span><span class="p">,</span> <span class="s1">'mouse'</span><span class="p">,</span> <span class="s1">'teclado'</span><span class="p">],</span>
                <span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-01-15'</span><span class="p">,</span>
                <span class="s1">'total'</span><span class="p">:</span> <span class="mf">1250.00</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[]</span>  <span class="c1"># Sin relaciones útiles para consultas</span>
    <span class="p">}</span>

    <span class="c1"># ✅ MODELO OPTIMIZADO: Entidades separadas con relaciones explícitas</span>
    <span class="n">modelo_optimizado</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Usuarios</span>
            <span class="s1">'ana_garcia'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Ana García'</span><span class="p">,</span>
                <span class="s1">'email'</span><span class="p">:</span> <span class="s1">'ana@email.com'</span><span class="p">,</span>
                <span class="s1">'fecha_registro'</span><span class="p">:</span> <span class="s1">'2023-01-15'</span>
            <span class="p">},</span>
            <span class="s1">'carlos_lopez'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'usuario'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Carlos López'</span><span class="p">,</span> 
                <span class="s1">'email'</span><span class="p">:</span> <span class="s1">'carlos@email.com'</span><span class="p">,</span>
                <span class="s1">'fecha_registro'</span><span class="p">:</span> <span class="s1">'2023-02-20'</span>
            <span class="p">},</span>

            <span class="c1"># Productos</span>
            <span class="s1">'laptop_gaming'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'producto'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Laptop Gaming Pro'</span><span class="p">,</span>
                <span class="s1">'precio'</span><span class="p">:</span> <span class="mf">1200.00</span><span class="p">,</span>
                <span class="s1">'categoria'</span><span class="p">:</span> <span class="s1">'electronica'</span><span class="p">,</span>
                <span class="s1">'marca'</span><span class="p">:</span> <span class="s1">'TechBrand'</span>
            <span class="p">},</span>
            <span class="s1">'mouse_wireless'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'producto'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Mouse Inalámbrico'</span><span class="p">,</span>
                <span class="s1">'precio'</span><span class="p">:</span> <span class="mf">25.00</span><span class="p">,</span>
                <span class="s1">'categoria'</span><span class="p">:</span> <span class="s1">'accesorios'</span><span class="p">,</span>
                <span class="s1">'marca'</span><span class="p">:</span> <span class="s1">'TechBrand'</span>
            <span class="p">},</span>
            <span class="s1">'teclado_mecanico'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'producto'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Teclado Mecánico RGB'</span><span class="p">,</span>
                <span class="s1">'precio'</span><span class="p">:</span> <span class="mf">85.00</span><span class="p">,</span>
                <span class="s1">'categoria'</span><span class="p">:</span> <span class="s1">'accesorios'</span><span class="p">,</span>
                <span class="s1">'marca'</span><span class="p">:</span> <span class="s1">'GamerTech'</span>
            <span class="p">},</span>

            <span class="c1"># Pedidos</span>
            <span class="s1">'pedido_001'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'pedido'</span><span class="p">,</span>
                <span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-01-15'</span><span class="p">,</span>
                <span class="s1">'estado'</span><span class="p">:</span> <span class="s1">'entregado'</span><span class="p">,</span>
                <span class="s1">'total'</span><span class="p">:</span> <span class="mf">1310.00</span>
            <span class="p">},</span>
            <span class="s1">'pedido_002'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'pedido'</span><span class="p">,</span>
                <span class="s1">'fecha'</span><span class="p">:</span> <span class="s1">'2024-01-20'</span><span class="p">,</span>
                <span class="s1">'estado'</span><span class="p">:</span> <span class="s1">'enviado'</span><span class="p">,</span>
                <span class="s1">'total'</span><span class="p">:</span> <span class="mf">110.00</span>
            <span class="p">},</span>

            <span class="c1"># Categorías (para recomendaciones)</span>
            <span class="s1">'categoria_electronica'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'categoria'</span><span class="p">,</span>
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Electrónicos'</span><span class="p">,</span>
                <span class="s1">'descripcion'</span><span class="p">:</span> <span class="s1">'Dispositivos electrónicos'</span>
            <span class="p">},</span>
            <span class="s1">'categoria_accesorios'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'categoria'</span><span class="p">,</span> 
                <span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Accesorios'</span><span class="p">,</span>
                <span class="s1">'descripcion'</span><span class="p">:</span> <span class="s1">'Accesorios para computadora'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Relación usuario-pedido (para historial)</span>
            <span class="p">(</span><span class="s1">'ana_garcia'</span><span class="p">,</span> <span class="s1">'pedido_001'</span><span class="p">,</span> <span class="s1">'REALIZO_PEDIDO'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'carlos_lopez'</span><span class="p">,</span> <span class="s1">'pedido_002'</span><span class="p">,</span> <span class="s1">'REALIZO_PEDIDO'</span><span class="p">),</span>

            <span class="c1"># Relación pedido-producto (para detalles)</span>
            <span class="p">(</span><span class="s1">'pedido_001'</span><span class="p">,</span> <span class="s1">'laptop_gaming'</span><span class="p">,</span> <span class="s1">'INCLUYE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'cantidad'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'precio_unitario'</span><span class="p">:</span> <span class="mf">1200.00</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'pedido_001'</span><span class="p">,</span> <span class="s1">'mouse_wireless'</span><span class="p">,</span> <span class="s1">'INCLUYE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'cantidad'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'precio_unitario'</span><span class="p">:</span> <span class="mf">25.00</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'pedido_001'</span><span class="p">,</span> <span class="s1">'teclado_mecanico'</span><span class="p">,</span> <span class="s1">'INCLUYE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'cantidad'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'precio_unitario'</span><span class="p">:</span> <span class="mf">85.00</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'pedido_002'</span><span class="p">,</span> <span class="s1">'mouse_wireless'</span><span class="p">,</span> <span class="s1">'INCLUYE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'cantidad'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'precio_unitario'</span><span class="p">:</span> <span class="mf">25.00</span><span class="p">}),</span>
            <span class="p">(</span><span class="s1">'pedido_002'</span><span class="p">,</span> <span class="s1">'teclado_mecanico'</span><span class="p">,</span> <span class="s1">'INCLUYE'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'cantidad'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'precio_unitario'</span><span class="p">:</span> <span class="mf">85.00</span><span class="p">}),</span>

            <span class="c1"># Relación producto-categoría (para recomendaciones)</span>
            <span class="p">(</span><span class="s1">'laptop_gaming'</span><span class="p">,</span> <span class="s1">'categoria_electronica'</span><span class="p">,</span> <span class="s1">'PERTENECE_A'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'mouse_wireless'</span><span class="p">,</span> <span class="s1">'categoria_accesorios'</span><span class="p">,</span> <span class="s1">'PERTENECE_A'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'teclado_mecanico'</span><span class="p">,</span> <span class="s1">'categoria_accesorios'</span><span class="p">,</span> <span class="s1">'PERTENECE_A'</span><span class="p">),</span>

            <span class="c1"># Relaciones de compatibilidad (para recomendaciones)</span>
            <span class="p">(</span><span class="s1">'laptop_gaming'</span><span class="p">,</span> <span class="s1">'mouse_wireless'</span><span class="p">,</span> <span class="s1">'COMPATIBLE_CON'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'laptop_gaming'</span><span class="p">,</span> <span class="s1">'teclado_mecanico'</span><span class="p">,</span> <span class="s1">'COMPATIBLE_CON'</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'mouse_wireless'</span><span class="p">,</span> <span class="s1">'teclado_mecanico'</span><span class="p">,</span> <span class="s1">'COMBINA_CON'</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">consultas_optimizadas</span><span class="p">(</span><span class="n">modelo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Implementa consultas eficientes sobre el modelo optimizado"""</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">productos_comprados_por_usuario</span><span class="p">(</span><span class="n">usuario_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""CONSULTA 1: Productos que compró el usuario X"""</span>
            <span class="n">productos</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Paso 1: Encontrar pedidos del usuario</span>
            <span class="n">pedidos_usuario</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'REALIZO_PEDIDO'</span><span class="p">:</span>
                    <span class="n">pedidos_usuario</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Paso 2: Encontrar productos en esos pedidos</span>
            <span class="k">for</span> <span class="n">pedido_id</span> <span class="ow">in</span> <span class="n">pedidos_usuario</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">pedido_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'INCLUYE'</span><span class="p">:</span>
                        <span class="n">producto_info</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">producto_info</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">producto_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Cantidad, precio</span>
                        <span class="n">productos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">producto_info</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">productos</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">usuarios_que_compraron_producto</span><span class="p">(</span><span class="n">producto_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""CONSULTA 2: Usuarios que compraron el producto Y"""</span>
            <span class="n">usuarios</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="c1"># Encontrar pedidos que incluyen el producto</span>
            <span class="n">pedidos_con_producto</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">producto_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'INCLUYE'</span><span class="p">:</span>
                    <span class="n">pedidos_con_producto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Encontrar usuarios de esos pedidos</span>
            <span class="k">for</span> <span class="n">pedido_id</span> <span class="ow">in</span> <span class="n">pedidos_con_producto</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">pedido_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'REALIZO_PEDIDO'</span><span class="p">:</span>
                        <span class="n">usuarios</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">usuarios</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">productos_relacionados</span><span class="p">(</span><span class="n">producto_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""CONSULTA 3: Productos relacionados/recomendados"""</span>
            <span class="n">relacionados</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Método 1: Productos compatibles directos</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">producto_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'COMPATIBLE_CON'</span><span class="p">,</span> <span class="s1">'COMBINA_CON'</span><span class="p">]:</span>
                    <span class="n">relacionados</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'directo'</span><span class="p">,</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">producto_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'COMPATIBLE_CON'</span><span class="p">,</span> <span class="s1">'COMBINA_CON'</span><span class="p">]:</span>
                    <span class="n">relacionados</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'directo'</span><span class="p">,</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="c1"># Método 2: Productos de la misma categoría</span>
            <span class="n">categoria_producto</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">producto_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'PERTENECE_A'</span><span class="p">:</span>
                    <span class="n">categoria_producto</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">categoria_producto</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">categoria_producto</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'PERTENECE_A'</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">producto_id</span><span class="p">:</span>
                            <span class="n">relacionados</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'categoria'</span><span class="p">,</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="c1"># Método 3: Productos frecuentemente comprados juntos</span>
            <span class="n">usuarios_compradores</span> <span class="o">=</span> <span class="n">usuarios_que_compraron_producto</span><span class="p">(</span><span class="n">producto_id</span><span class="p">)</span>
            <span class="n">productos_frecuentes</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">usuario</span> <span class="ow">in</span> <span class="n">usuarios_compradores</span><span class="p">:</span>
                <span class="n">productos_usuario</span> <span class="o">=</span> <span class="n">productos_comprados_por_usuario</span><span class="p">(</span><span class="n">usuario</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">productos_usuario</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">prod</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">producto_id</span><span class="p">:</span>
                        <span class="n">productos_frecuentes</span><span class="p">[</span><span class="n">prod</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">productos_frecuentes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prod</span><span class="p">[</span><span class="s1">'id'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Ordenar por frecuencia</span>
            <span class="k">for</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">frecuencia</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">productos_frecuentes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">relacionados</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'frecuente'</span><span class="p">,</span> <span class="n">prod_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">relacionados</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">historial_usuario</span><span class="p">(</span><span class="n">usuario_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""CONSULTA 4: Historial completo del usuario"""</span>
            <span class="n">historial</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">'pedidos'</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">'productos_unicos'</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                <span class="s1">'gasto_total'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">'categorias_preferidas'</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>

            <span class="c1"># Obtener todos los pedidos</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">usuario_id</span> <span class="ow">and</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'REALIZO_PEDIDO'</span><span class="p">:</span>
                    <span class="n">pedido_info</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">pedido_info</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># Obtener productos del pedido</span>
                    <span class="n">productos_pedido</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">rel2</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">rel2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">rel2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'INCLUYE'</span><span class="p">:</span>
                            <span class="n">producto_info</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">rel2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">producto_info</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="n">producto_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rel2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                            <span class="n">productos_pedido</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">producto_info</span><span class="p">)</span>

                            <span class="n">historial</span><span class="p">[</span><span class="s1">'productos_unicos'</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                            <span class="c1"># Contar categorías preferidas</span>
                            <span class="n">categoria</span> <span class="o">=</span> <span class="n">producto_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'categoria'</span><span class="p">,</span> <span class="s1">'sin_categoria'</span><span class="p">)</span>
                            <span class="n">historial</span><span class="p">[</span><span class="s1">'categorias_preferidas'</span><span class="p">][</span><span class="n">categoria</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">historial</span><span class="p">[</span><span class="s1">'categorias_preferidas'</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">categoria</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="n">pedido_info</span><span class="p">[</span><span class="s1">'productos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">productos_pedido</span>
                    <span class="n">historial</span><span class="p">[</span><span class="s1">'pedidos'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pedido_info</span><span class="p">)</span>
                    <span class="n">historial</span><span class="p">[</span><span class="s1">'gasto_total'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pedido_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'total'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Ordenar pedidos por fecha</span>
            <span class="n">historial</span><span class="p">[</span><span class="s1">'pedidos'</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'fecha'</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">historial</span><span class="p">[</span><span class="s1">'productos_unicos'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">historial</span><span class="p">[</span><span class="s1">'productos_unicos'</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">historial</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'productos_comprados_por_usuario'</span><span class="p">:</span> <span class="n">productos_comprados_por_usuario</span><span class="p">,</span>
            <span class="s1">'usuarios_que_compraron_producto'</span><span class="p">:</span> <span class="n">usuarios_que_compraron_producto</span><span class="p">,</span>
            <span class="s1">'productos_relacionados'</span><span class="p">:</span> <span class="n">productos_relacionados</span><span class="p">,</span>
            <span class="s1">'historial_usuario'</span><span class="p">:</span> <span class="n">historial_usuario</span>
        <span class="p">}</span>

    <span class="c1"># Demostrar eficiencia de consultas</span>
    <span class="n">consultas</span> <span class="o">=</span> <span class="n">consultas_optimizadas</span><span class="p">(</span><span class="n">modelo_optimizado</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Consultas Optimizadas - E-commerce:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"=================================="</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"1. Productos comprados por Ana:"</span><span class="p">)</span>
    <span class="n">productos_ana</span> <span class="o">=</span> <span class="n">consultas</span><span class="p">[</span><span class="s1">'productos_comprados_por_usuario'</span><span class="p">](</span><span class="s1">'ana_garcia'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">producto</span> <span class="ow">in</span> <span class="n">productos_ana</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">producto</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">]</span><span class="si">}</span><span class="s2"> - €</span><span class="si">{</span><span class="n">producto</span><span class="p">[</span><span class="s1">'precio'</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Cantidad: </span><span class="si">{</span><span class="n">producto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'cantidad'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">2. Usuarios que compraron Mouse Inalámbrico:"</span><span class="p">)</span>
    <span class="n">usuarios_mouse</span> <span class="o">=</span> <span class="n">consultas</span><span class="p">[</span><span class="s1">'usuarios_que_compraron_producto'</span><span class="p">](</span><span class="s1">'mouse_wireless'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">usuario_id</span> <span class="ow">in</span> <span class="n">usuarios_mouse</span><span class="p">:</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">modelo_optimizado</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">usuario_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">3. Productos relacionados con Laptop Gaming:"</span><span class="p">)</span>
    <span class="n">relacionados</span> <span class="o">=</span> <span class="n">consultas</span><span class="p">[</span><span class="s1">'productos_relacionados'</span><span class="p">](</span><span class="s1">'laptop_gaming'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tipo</span><span class="p">,</span> <span class="n">producto_id</span> <span class="ow">in</span> <span class="n">relacionados</span><span class="p">:</span>
        <span class="n">nombre</span> <span class="o">=</span> <span class="n">modelo_optimizado</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">producto_id</span><span class="p">][</span><span class="s1">'nombre'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2"> (relación: </span><span class="si">{</span><span class="n">tipo</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">4. Historial completo de Ana:"</span><span class="p">)</span>
    <span class="n">historial</span> <span class="o">=</span> <span class="n">consultas</span><span class="p">[</span><span class="s1">'historial_usuario'</span><span class="p">](</span><span class="s1">'ana_garcia'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • Total de pedidos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">historial</span><span class="p">[</span><span class="s1">'pedidos'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • Productos únicos: </span><span class="si">{</span><span class="n">historial</span><span class="p">[</span><span class="s1">'productos_unicos'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • Gasto total: €</span><span class="si">{</span><span class="n">historial</span><span class="p">[</span><span class="s1">'gasto_total'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • Categorías preferidas: </span><span class="si">{</span><span class="nb">dict</span><span class="p">(</span><span class="n">historial</span><span class="p">[</span><span class="s1">'categorias_preferidas'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">modelo_optimizado</span>

<span class="n">modelo_ecommerce</span> <span class="o">=</span> <span class="n">optimizar_para_consultas</span><span class="p">()</span>
</pre>
    </div>
   </div>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="44-ejercicios-practicos-de-modelado">
    4.4 Ejercicios Prácticos de Modelado
   </h2>
   <h3 id="ejercicio-1-sistema-de-gestion-hospitalaria">
    Ejercicio 1: Sistema de Gestión Hospitalaria
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ejercicio_hospital</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Diseña un modelo de grafos para un sistema hospitalario"""</span>

    <span class="c1"># REQUISITOS:</span>
    <span class="c1"># - Pacientes con historial médico</span>
    <span class="c1"># - Médicos con especialidades</span>
    <span class="c1"># - Citas médicas programadas</span>
    <span class="c1"># - Tratamientos y medicamentos</span>
    <span class="c1"># - Departamentos del hospital</span>
    <span class="c1"># - Historial de hospitalizaciones</span>

    <span class="n">hospital_modelo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># TODO: Define los nodos necesarios</span>
            <span class="c1"># Considera: pacientes, médicos, departamentos, medicamentos, etc.</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># TODO: Define las relaciones</span>
            <span class="c1"># Considera: citas, tratamientos, prescripciones, etc.</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">consultas_hospital</span><span class="p">():</span>
<span class="w">        </span><span class="sd">"""Implementa consultas típicas del sistema hospitalario"""</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">historial_paciente</span><span class="p">(</span><span class="n">paciente_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Historial médico completo de un paciente"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">agenda_medico</span><span class="p">(</span><span class="n">medico_id</span><span class="p">,</span> <span class="n">fecha</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Citas programadas para un médico en una fecha"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">pacientes_por_especialidad</span><span class="p">(</span><span class="n">especialidad</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Pacientes atendidos por una especialidad"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">medicamentos_prescritos</span><span class="p">(</span><span class="n">paciente_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Medicamentos actuales de un paciente"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ocupacion_departamento</span><span class="p">(</span><span class="n">departamento_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Nivel de ocupación de un departamento"""</span>
            <span class="k">pass</span>

    <span class="c1"># TODO: Implementa el modelo y las consultas</span>
    <span class="k">return</span> <span class="n">hospital_modelo</span>

<span class="c1"># Pistas para la implementación:</span>
<span class="c1"># - ¿Qué entidades tienen identidad propia?</span>
<span class="c1"># - ¿Cómo modelar citas (como nodos o relaciones)?</span>
<span class="c1"># - ¿Cómo manejar el historial temporal?</span>
<span class="c1"># - ¿Qué relaciones son más importantes para las consultas?</span>
</pre>
    </div>
   </div>
   <h3 id="ejercicio-2-plataforma-de-cursos-online">
    Ejercicio 2: Plataforma de Cursos Online
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ejercicio_plataforma_educativa</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Diseña un modelo para una plataforma de educación online"""</span>

    <span class="c1"># REQUISITOS:</span>
    <span class="c1"># - Estudiantes inscritos en cursos</span>
    <span class="c1"># - Instructores que crean cursos</span>
    <span class="c1"># - Cursos organizados en módulos y lecciones</span>
    <span class="c1"># - Progreso de estudiantes por lección</span>
    <span class="c1"># - Evaluaciones y calificaciones</span>
    <span class="c1"># - Certificaciones obtenidas</span>
    <span class="c1"># - Reseñas de cursos</span>
    <span class="c1"># - Rutas de aprendizaje (pre-requisitos)</span>

    <span class="n">plataforma_modelo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># TODO: Define nodos para todas las entidades</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># TODO: Define relaciones complejas</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">consultas_educativas</span><span class="p">():</span>
<span class="w">        </span><span class="sd">"""Consultas típicas de la plataforma"""</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">progreso_estudiante</span><span class="p">(</span><span class="n">estudiante_id</span><span class="p">,</span> <span class="n">curso_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Progreso detallado en un curso específico"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">cursos_recomendados</span><span class="p">(</span><span class="n">estudiante_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Recomienda cursos basado en historial"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">estadisticas_instructor</span><span class="p">(</span><span class="n">instructor_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Estadísticas de todos los cursos de un instructor"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">estudiantes_en_riesgo</span><span class="p">(</span><span class="n">curso_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Estudiantes con bajo progreso"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ruta_aprendizaje</span><span class="p">(</span><span class="n">objetivo_curso_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Secuencia óptima de cursos para llegar al objetivo"""</span>
            <span class="k">pass</span>

    <span class="c1"># TODO: Implementa considerando:</span>
    <span class="c1"># - ¿Cómo modelar progreso incremental?</span>
    <span class="c1"># - ¿Rutas de aprendizaje como relaciones o nodos?</span>
    <span class="c1"># - ¿Cómo optimizar para recomendaciones?</span>

    <span class="k">return</span> <span class="n">plataforma_modelo</span>
</pre>
    </div>
   </div>
   <h3 id="ejercicio-3-red-de-suministro-global">
    Ejercicio 3: Red de Suministro Global
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ejercicio_cadena_suministro</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Modela una cadena de suministro global compleja"""</span>

    <span class="c1"># REQUISITOS:</span>
    <span class="c1"># - Proveedores en diferentes países</span>
    <span class="c1"># - Fábricas con capacidades de producción</span>
    <span class="c1"># - Centros de distribución</span>
    <span class="c1"># - Productos con componentes</span>
    <span class="c1"># - Rutas de transporte con costos</span>
    <span class="c1"># - Inventarios en tiempo real</span>
    <span class="c1"># - Demanda por región</span>
    <span class="c1"># - Riesgos geopolíticos</span>

    <span class="n">cadena_suministro</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># TODO: Considera la complejidad geográfica</span>
        <span class="p">},</span>
        <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># TODO: Modela flujos de materiales y productos</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analisis_suministro</span><span class="p">():</span>
<span class="w">        </span><span class="sd">"""Análisis crítico de la cadena de suministro"""</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">puntos_criticos</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Identifica cuellos de botella en la cadena"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">rutas_alternativas</span><span class="p">(</span><span class="n">origen</span><span class="p">,</span> <span class="n">destino</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Encuentra rutas alternativas ante disrupciones"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">impacto_disrupcion</span><span class="p">(</span><span class="n">nodo_afectado</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Simula impacto de interrupción en un nodo"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">optimizar_inventarios</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Sugiere niveles óptimos de inventario"""</span>
            <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">riesgo_concentracion</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Analiza riesgos de concentración geográfica"""</span>
            <span class="k">pass</span>

    <span class="c1"># TODO: Considera:</span>
    <span class="c1"># - ¿Cómo modelar capacidades y limitaciones?</span>
    <span class="c1"># - ¿Inventarios como propiedades o nodos?</span>
    <span class="c1"># - ¿Cómo representar riesgos y alternativas?</span>

    <span class="k">return</span> <span class="n">cadena_suministro</span>
</pre>
    </div>
   </div>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="45-validacion-y-mejores-practicas">
    4.5 Validación y Mejores Prácticas
   </h2>
   <h3 id="checklist-de-validacion-del-modelo">
    Checklist de Validación del Modelo
   </h3>
   <div class="highlight language-python">
    <div class="collapsible-container" data-max-lines="6">
     <pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validar_modelo_completo</span><span class="p">(</span><span class="n">modelo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Validación exhaustiva de un modelo de grafos"""</span>

    <span class="n">problemas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">advertencias</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 1. Validación de Nodos</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_nodos</span><span class="p">():</span>
        <span class="n">nodos_sin_tipo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodos_sin_propiedades</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">nodo_id</span><span class="p">,</span> <span class="n">propiedades</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">'tipo'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">propiedades</span><span class="p">:</span>
                <span class="n">nodos_sin_tipo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodo_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">propiedades</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Solo tipo</span>
                <span class="n">nodos_sin_propiedades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodo_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodos_sin_tipo</span><span class="p">:</span>
            <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodos sin tipo: </span><span class="si">{</span><span class="n">nodos_sin_tipo</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodos_sin_propiedades</span><span class="p">:</span>
            <span class="n">advertencias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodos con pocas propiedades: </span><span class="si">{</span><span class="n">nodos_sin_propiedades</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># 2. Validación de Relaciones</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_relaciones</span><span class="p">():</span>
        <span class="n">relaciones_invalidas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodos_aislados</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">tipos_relacion</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="c1"># Verificar formato mínimo</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">relaciones_invalidas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">origen</span><span class="p">,</span> <span class="n">destino</span><span class="p">,</span> <span class="n">tipo_rel</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">tipos_relacion</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tipo_rel</span><span class="p">)</span>

            <span class="c1"># Verificar que los nodos existen</span>
            <span class="k">if</span> <span class="n">origen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]:</span>
                <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodo origen inexistente: </span><span class="si">{</span><span class="n">origen</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">rel</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodos_aislados</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">origen</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">destino</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]:</span>
                <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodo destino inexistente: </span><span class="si">{</span><span class="n">destino</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">rel</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodos_aislados</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">destino</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">relaciones_invalidas</span><span class="p">:</span>
            <span class="n">problemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Relaciones con formato inválido: </span><span class="si">{</span><span class="n">relaciones_invalidas</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodos_aislados</span><span class="p">:</span>
            <span class="n">advertencias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Nodos sin relaciones: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">nodos_aislados</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tipos_relacion</span>

    <span class="c1"># 3. Validación de Consistencia</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_consistencia</span><span class="p">():</span>
        <span class="c1"># Verificar que las relaciones tienen sentido semántico</span>
        <span class="n">tipos_nodos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nodo_id</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tipo</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tipo'</span><span class="p">,</span> <span class="s1">'sin_tipo'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tipo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tipos_nodos</span><span class="p">:</span>
                <span class="n">tipos_nodos</span><span class="p">[</span><span class="n">tipo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tipos_nodos</span><span class="p">[</span><span class="n">tipo</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodo_id</span><span class="p">)</span>

        <span class="n">relaciones_inconsistentes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">origen</span><span class="p">,</span> <span class="n">destino</span><span class="p">,</span> <span class="n">tipo_rel</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">tipo_origen</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">origen</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tipo'</span><span class="p">,</span> <span class="s1">'sin_tipo'</span><span class="p">)</span>
                <span class="n">tipo_destino</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">][</span><span class="n">destino</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tipo'</span><span class="p">,</span> <span class="s1">'sin_tipo'</span><span class="p">)</span>

                <span class="c1"># Detectar relaciones potencialmente problemáticas</span>
                <span class="k">if</span> <span class="n">tipo_origen</span> <span class="o">==</span> <span class="n">tipo_destino</span> <span class="ow">and</span> <span class="n">tipo_rel</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'ES_UN'</span><span class="p">,</span> <span class="s1">'TIPO_DE'</span><span class="p">]:</span>
                    <span class="n">relaciones_inconsistentes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">rel</span><span class="si">}</span><span class="s2"> - relación jerárquica entre mismo tipo"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">relaciones_inconsistentes</span><span class="p">:</span>
            <span class="n">advertencias</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">relaciones_inconsistentes</span><span class="p">)</span>

    <span class="c1"># 4. Análisis de Densidad y Conectividad</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analizar_conectividad</span><span class="p">():</span>
        <span class="n">total_nodos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">])</span>
        <span class="n">total_relaciones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">total_nodos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_relaciones</span> <span class="o">=</span> <span class="n">total_nodos</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_nodos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">densidad</span> <span class="o">=</span> <span class="n">total_relaciones</span> <span class="o">/</span> <span class="n">max_relaciones</span> <span class="k">if</span> <span class="n">max_relaciones</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">densidad</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
                <span class="n">advertencias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Modelo muy denso (</span><span class="si">{</span><span class="n">densidad</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) - considerar simplificar"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">densidad</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="n">total_nodos</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">advertencias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Modelo muy disperso (</span><span class="si">{</span><span class="n">densidad</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) - verificar conexiones"</span><span class="p">)</span>

    <span class="c1"># Ejecutar validaciones</span>
    <span class="n">validar_nodos</span><span class="p">()</span>
    <span class="n">tipos_rel</span> <span class="o">=</span> <span class="n">validar_relaciones</span><span class="p">()</span>
    <span class="n">validar_consistencia</span><span class="p">()</span>
    <span class="n">analizar_conectividad</span><span class="p">()</span>

    <span class="c1"># Generar reporte</span>
    <span class="n">reporte</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'problemas_criticos'</span><span class="p">:</span> <span class="n">problemas</span><span class="p">,</span>
        <span class="s1">'advertencias'</span><span class="p">:</span> <span class="n">advertencias</span><span class="p">,</span>
        <span class="s1">'estadisticas'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'total_nodos'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]),</span>
            <span class="s1">'total_relaciones'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelo</span><span class="p">[</span><span class="s1">'relaciones'</span><span class="p">]),</span>
            <span class="s1">'tipos_nodos'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tipo'</span><span class="p">,</span> <span class="s1">'sin_tipo'</span><span class="p">)</span> 
                                 <span class="k">for</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">modelo</span><span class="p">[</span><span class="s1">'nodos'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
            <span class="s1">'tipos_relaciones'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipos_rel</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">reporte</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mejores_practicas</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Guía de mejores prácticas para modelado de grafos"""</span>

    <span class="n">practicas</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'nomenclatura'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"Usar nombres descriptivos para nodos (ana_garcia, no user_1)"</span><span class="p">,</span>
            <span class="s2">"Tipos de relación en MAYÚSCULAS (TRABAJA_EN, AMIGO_DE)"</span><span class="p">,</span>
            <span class="s2">"Consistencia en nombres (siempre en español o inglés)"</span><span class="p">,</span>
            <span class="s2">"Evitar espacios en IDs (usar _ o camelCase)"</span>
        <span class="p">],</span>

        <span class="s1">'estructura'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"Entidades con identidad propia → Nodos"</span><span class="p">,</span>
            <span class="s2">"Interacciones y asociaciones → Relaciones"</span><span class="p">,</span> 
            <span class="s2">"Atributos descriptivos → Propiedades"</span><span class="p">,</span>
            <span class="s2">"Evitar nodos que son realmente propiedades"</span>
        <span class="p">],</span>

        <span class="s1">'performance'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"Modelar según consultas más frecuentes"</span><span class="p">,</span>
            <span class="s2">"Crear índices implícitos con relaciones directas"</span><span class="p">,</span>
            <span class="s2">"Evitar relaciones muy profundas (&gt;5 saltos)"</span><span class="p">,</span>
            <span class="s2">"Balancear entre normalización y desnormalización"</span>
        <span class="p">],</span>

        <span class="s1">'mantenibilidad'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"Documentar el esquema y sus decisiones"</span><span class="p">,</span>
            <span class="s2">"Usar tipos consistentes para validación"</span><span class="p">,</span>
            <span class="s2">"Planificar evolución del esquema"</span><span class="p">,</span>
            <span class="s2">"Mantener ejemplos de consultas típicas"</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">practicas</span>

<span class="c1"># Ejemplo de uso con validación</span>
<span class="n">ejemplo_validacion</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'nodos'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'user_1'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'nombre'</span><span class="p">:</span> <span class="s1">'Ana'</span><span class="p">},</span>  <span class="c1"># ❌ Sin tipo</span>
        <span class="s1">'producto_laptop'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'producto'</span><span class="p">,</span> <span class="s1">'precio'</span><span class="p">:</span> <span class="mi">1200</span><span class="p">},</span>  <span class="c1"># ✅ Bien</span>
        <span class="s1">'nodo_aislado'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'tipo'</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">}</span>  <span class="c1"># ⚠️ Sin relaciones</span>
    <span class="p">},</span>
    <span class="s1">'relaciones'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'user_1'</span><span class="p">,</span> <span class="s1">'producto_laptop'</span><span class="p">,</span> <span class="s1">'COMPRO'</span><span class="p">),</span>  <span class="c1"># ✅ Bien</span>
        <span class="p">(</span><span class="s1">'inexistente'</span><span class="p">,</span> <span class="s1">'producto_laptop'</span><span class="p">)</span>  <span class="c1"># ❌ Formato incorrecto</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">reporte</span> <span class="o">=</span> <span class="n">validar_modelo_completo</span><span class="p">(</span><span class="n">ejemplo_validacion</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Reporte de Validación:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"====================="</span><span class="p">)</span>
<span class="k">if</span> <span class="n">reporte</span><span class="p">[</span><span class="s1">'problemas_criticos'</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"❌ PROBLEMAS CRÍTICOS:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">problema</span> <span class="ow">in</span> <span class="n">reporte</span><span class="p">[</span><span class="s1">'problemas_criticos'</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">problema</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">reporte</span><span class="p">[</span><span class="s1">'advertencias'</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">⚠️  ADVERTENCIAS:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">advertencia</span> <span class="ow">in</span> <span class="n">reporte</span><span class="p">[</span><span class="s1">'advertencias'</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">advertencia</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">📊 ESTADÍSTICAS:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">reporte</span><span class="p">[</span><span class="s1">'estadisticas'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"   • </span><span class="si">{</span><span class="n">clave</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">valor</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
    </div>
   </div>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="46-resumen-y-preparacion">
    4.6 Resumen y Preparación
   </h2>
   <h3 id="conceptos-clave-del-modelado">
    Conceptos Clave del Modelado
   </h3>
   <ul>
    <li>
     [ ]
     <strong>
      Identificación de entidades
     </strong>
    </li>
    <li>
     Nodos para elementos con identidad propia
    </li>
    <li>
     <p>
      Propiedades para atributos descriptivos
     </p>
    </li>
    <li>
     <p>
      [ ]
      <strong>
       Diseño de relaciones
      </strong>
     </p>
    </li>
    <li>
     Relaciones para interacciones significativas
    </li>
    <li>
     <p>
      Propiedades en relaciones para metadatos
     </p>
    </li>
    <li>
     <p>
      [ ]
      <strong>
       Patrones comunes
      </strong>
     </p>
    </li>
    <li>
     Jerárquicos (árboles organizacionales)
    </li>
    <li>
     Muchos a muchos (redes sociales)
    </li>
    <li>
     <p>
      Temporales (historiales)
     </p>
    </li>
    <li>
     <p>
      [ ]
      <strong>
       Optimización
      </strong>
     </p>
    </li>
    <li>
     Modelar según consultas frecuentes
    </li>
    <li>
     Balance entre normalización y performance
    </li>
   </ul>
   <hr/>
  </div>
  <div class="chapter-container">
   <h2 id="47-preparacion-para-el-siguiente-tema">
    4.7 Preparación para el Siguiente Tema
   </h2>
   <p>
    En el próximo tema exploraremos
    <strong>
     algoritmos básicos de grafos
    </strong>
    , incluyendo:
- Algoritmos de recorrido avanzados
- Camino más corto con pesos
- Detección de comunidades
- Métricas de centralidad avanzadas
   </p>
  </div>
  <textarea id="css-editor" style="display:none;">pre {line-height: 125%;}

td.linenos .normal {color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;}

span.linenos {color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;}

td.linenos .special {color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px;}

span.linenos.special {color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px;}

.highlight .hll {background-color: #ffffcc;}

.highlight {background: #f8f8f8; padding: 0; border-radius: 5px; margin: 15px 0; background-color: #fef6e4 !important; border: 1px solid #f0e6d4; box-shadow: 0 1px 3px rgba(0,0,0,0.1);}

.highlight .c {color: #9a8052 !important; font-style: italic;}

/* Comment */
.highlight .err {border: 1px solid #F00;}

/* Error */
.highlight .k {color: #008000; font-weight: bold;}

/* Keyword */
.highlight .o {color: #666;}

/* Operator */
.highlight .ch {color: #3D7B7B; font-style: italic;}

/* Comment.Hashbang */
.highlight .cm {color: #3D7B7B; font-style: italic;}

/* Comment.Multiline */
.highlight .cp {color: #9C6500;}

/* Comment.Preproc */
.highlight .cpf {color: #3D7B7B; font-style: italic;}

/* Comment.PreprocFile */
.highlight .c1 {color: #3D7B7B; font-style: italic;}

/* Comment.Single */
.highlight .cs {color: #3D7B7B; font-style: italic;}

/* Comment.Special */
.highlight .gd {color: #A00000;}

/* Generic.Deleted */
.highlight .ge {font-style: italic;}

/* Generic.Emph */
.highlight .ges {font-weight: bold; font-style: italic;}

/* Generic.EmphStrong */
.highlight .gr {color: #E40000;}

/* Generic.Error */
.highlight .gh {color: #000080; font-weight: bold;}

/* Generic.Heading */
.highlight .gi {color: #008400;}

/* Generic.Inserted */
.highlight .go {color: #717171;}

/* Generic.Output */
.highlight .gp {color: #000080; font-weight: bold;}

/* Generic.Prompt */
.highlight .gs {font-weight: bold;}

/* Generic.Strong */
.highlight .gu {color: #800080; font-weight: bold;}

/* Generic.Subheading */
.highlight .gt {color: #04D;}

/* Generic.Traceback */
.highlight .kc {color: #008000; font-weight: bold;}

/* Keyword.Constant */
.highlight .kd {color: #008000; font-weight: bold;}

/* Keyword.Declaration */
.highlight .kn {color: #008000; font-weight: bold;}

/* Keyword.Namespace */
.highlight .kp {color: #008000;}

/* Keyword.Pseudo */
.highlight .kr {color: #008000; font-weight: bold;}

/* Keyword.Reserved */
.highlight .kt {color: #B00040;}

/* Keyword.Type */
.highlight .m {color: #666;}

/* Literal.Number */
.highlight .s {color: #BA2121;}

/* Literal.String */
.highlight .na {color: #687822;}

/* Name.Attribute */
.highlight .nb {color: #008000;}

/* Name.Builtin */
.highlight .nc {color: #00F; font-weight: bold;}

/* Name.Class */
.highlight .no {color: #800;}

/* Name.Constant */
.highlight .nd {color: #A2F;}

/* Name.Decorator */
.highlight .ni {color: #717171; font-weight: bold;}

/* Name.Entity */
.highlight .ne {color: #CB3F38; font-weight: bold;}

/* Name.Exception */
.highlight .nf {color: #00F;}

/* Name.Function */
.highlight .nl {color: #767600;}

/* Name.Label */
.highlight .nn {color: #00F; font-weight: bold;}

/* Name.Namespace */
.highlight .nt {color: #008000; font-weight: bold;}

/* Name.Tag */
.highlight .nv {color: #19177C;}

/* Name.Variable */
.highlight .ow {color: #A2F; font-weight: bold;}

/* Operator.Word */
.highlight .w {color: #BBB;}

/* Text.Whitespace */
.highlight .mb {color: #666;}

/* Literal.Number.Bin */
.highlight .mf {color: #666;}

/* Literal.Number.Float */
.highlight .mh {color: #666;}

/* Literal.Number.Hex */
.highlight .mi {color: #666;}

/* Literal.Number.Integer */
.highlight .mo {color: #666;}

/* Literal.Number.Oct */
.highlight .sa {color: #BA2121;}

/* Literal.String.Affix */
.highlight .sb {color: #BA2121;}

/* Literal.String.Backtick */
.highlight .sc {color: #BA2121;}

/* Literal.String.Char */
.highlight .dl {color: #BA2121;}

/* Literal.String.Delimiter */
.highlight .sd {color: #BA2121; font-style: italic;}

/* Literal.String.Doc */
.highlight .s2 {color: #BA2121;}

/* Literal.String.Double */
.highlight .se {color: #AA5D1F; font-weight: bold;}

/* Literal.String.Escape */
.highlight .sh {color: #BA2121;}

/* Literal.String.Heredoc */
.highlight .si {color: #A45A77; font-weight: bold;}

/* Literal.String.Interpol */
.highlight .sx {color: #008000;}

/* Literal.String.Other */
.highlight .sr {color: #A45A77;}

/* Literal.String.Regex */
.highlight .s1 {color: #BA2121;}

/* Literal.String.Single */
.highlight .ss {color: #19177C;}

/* Literal.String.Symbol */
.highlight .bp {color: #008000;}

/* Name.Builtin.Pseudo */
.highlight .fm {color: #00F;}

/* Name.Function.Magic */
.highlight .vc {color: #19177C;}

/* Name.Variable.Class */
.highlight .vg {color: #19177C;}

/* Name.Variable.Global */
.highlight .vi {color: #19177C;}

/* Name.Variable.Instance */
.highlight .vm {color: #19177C;}

/* Name.Variable.Magic */
.highlight .il {color: #666;}

body {font-family: Arial, sans-serif; line-height: 1.6; margin: 0 auto; padding: 20px;}

#main-title-block {background-color: #2e2e2e; color: #f0f0f0; padding: 18px; border-radius: 10px; border: 1px solid #444; box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-size: 1.8em; font-weight: bold; margin-bottom: 20px; text-align: center;}

pre:not(.highlight pre) {background-color: #fef6e4; color: #2e2e2e; padding: 12px; border-radius: 5px; overflow-x: auto; border: 1px solid #f0e6d4; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin: 15px 0;}

code {font-family: "Courier New", Courier, monospace;}

.highlight pre {background: none; border: none; box-shadow: none; padding: 12px; margin: 0; border-radius: 0;}

.highlight .c1 {color: #9a8052 !important; font-style: italic;}

.highlight .cm {color: #9a8052 !important; font-style: italic;}

.highlight .k {color: #8250df !important; font-weight: normal;}

.highlight .kd {color: #8250df !important; font-weight: normal;}

.highlight .kn {color: #8250df !important; font-weight: normal;}

.highlight .s {color: #327d41 !important;}

.highlight .s1 {color: #327d41 !important;}

.highlight .s2 {color: #327d41 !important;}

.highlight .sb {color: #327d41 !important;}

.highlight .si {color: #327d41 !important;}

.highlight .m {color: #606060 !important;}

.highlight .mi {color: #606060 !important;}

.highlight .mf {color: #606060 !important;}

.highlight .o {color: #666666 !important; font-weight: normal;}

.highlight .ow {color: #666666 !important; font-weight: normal;}

.highlight .kc {color: #9a5b13 !important;}

.highlight .no {color: #9a5b13 !important;}

.highlight .nf {color: #606060 !important; font-weight: normal;}

.highlight .nb {color: #606060 !important; font-weight: normal;}

.highlight .nx {color: #606060 !important; font-weight: normal;}

.highlight .p {color: #666666 !important; font-weight: normal;}

.language-jsx .highlight .k {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-jsx .highlight .kd {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-jsx .highlight .kr {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-jsx .highlight .nx {color: #0969da !important; background: none !important; border: none !important;}

.language-jsx .highlight .nf {color: #0969da !important; background: none !important; border: none !important;}

.language-jsx .highlight .nt {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-jsx .highlight .nc {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-jsx .highlight .o {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-jsx .highlight .p {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-jsx .highlight .na {color: #0969da !important; background: none !important; border: none !important;}

.language-jsx .highlight .s {color: #0a3069 !important; background: none !important; border: none !important;}

.language-jsx .highlight .s1 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-jsx .highlight .s2 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-jsx .highlight .c {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-jsx .highlight .c1 {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-jsx .highlight .cm {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-jsx .highlight .m {color: #0969da !important; background: none !important; border: none !important;}

.language-jsx .highlight .mi {color: #0969da !important; background: none !important; border: none !important;}

.language-jsx .highlight .mf {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .k {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-react .highlight .kd {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-react .highlight .kr {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-react .highlight .nx {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .nf {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .nt {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-react .highlight .nc {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-react .highlight .o {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-react .highlight .p {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-react .highlight .na {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .s {color: #0a3069 !important; background: none !important; border: none !important;}

.language-react .highlight .s1 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-react .highlight .s2 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-react .highlight .c {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-react .highlight .c1 {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-react .highlight .cm {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-react .highlight .m {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .mi {color: #0969da !important; background: none !important; border: none !important;}

.language-react .highlight .mf {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .k {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-tsx .highlight .kd {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-tsx .highlight .kr {color: #af00db !important; font-weight: normal; background: none !important; border: none !important;}

.language-tsx .highlight .nx {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .nf {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .nt {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-tsx .highlight .nc {color: #116329 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-tsx .highlight .o {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-tsx .highlight .p {color: #666666 !important; background: none !important; border: none !important; box-shadow: none !important; outline: none !important;}

.language-tsx .highlight .na {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .s {color: #0a3069 !important; background: none !important; border: none !important;}

.language-tsx .highlight .s1 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-tsx .highlight .s2 {color: #0a3069 !important; background: none !important; border: none !important;}

.language-tsx .highlight .c {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-tsx .highlight .c1 {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-tsx .highlight .cm {color: #656d76 !important; font-style: italic; background: none !important; border: none !important;}

.language-tsx .highlight .m {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .mi {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .mf {color: #0969da !important; background: none !important; border: none !important;}

.language-tsx .highlight .kt {color: #0969da !important; background: none !important; border: none !important;}

.language-javascript .highlight .err {color: #116329 !important; background: none !important; border: none !important;}

.language-js .highlight .err {color: #116329 !important; background: none !important; border: none !important;}

.highlight span {background: none !important; border: none !important; box-shadow: none !important; text-decoration: none !important; outline: none !important;}

.empty-code-block {background-color: #fef6e4; color: #2e2e2e; padding: 12px; border-radius: 5px; margin: 15px 0; font-family: monospace; border: 1px solid #f0e6d4; box-shadow: 0 1px 3px rgba(0,0,0,0.1);}

.highlight-error {background-color: #fef6e4; color: #000080; padding: 12px; border-radius: 5px; margin: 15px 0; font-family: monospace; border: 1px solid #f0e6d4; box-shadow: 0 1px 3px rgba(0,0,0,0.1);}

img {max-width: 100%; height: auto;}

table {border-collapse: collapse; width: 100%;}

th {border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2;}

td {border: 1px solid #ddd; padding: 8px;}

.chapter-container {background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}

.chapter-container h2 {margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; color: #444;}

/* Estilos para el contenedor colapsable */
.collapsible-container {position: relative; overflow: hidden; transition: max-height 0.3s ease; border-radius: 8px; margin: 0;}

.collapsible-container pre {margin: 0; line-height: 1.4;}

.collapsible-container .toggle-button {position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.9); border: 1px solid #ccc; cursor: pointer; font-size: 16px; line-height: 1; padding: 4px 8px; border-radius: 4px; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}

.collapsible-container .toggle-button:hover {background: rgba(255,255,255,1);}

/* Estilos para el botón de copiar */
.collapsible-container .copy-button {position: absolute; top: 8px; width: 24px; display: flex; /* Usamos flexbox para centrar el icono/texto */
  align-items: center; justify-content: center; right: 48px; /* A 40 px a la izquierda del botón de colapsar */
  background: rgba(255,255,255,0.9); border: 1px solid #ccc; cursor: pointer; font-size: 16px; line-height: 1; padding: 4px 8px; border-radius: 4px; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}

.collapsible-container .copy-button:hover {background: rgba(255,255,255,1);}

.collapsible-container .fade-overlay {position: absolute; bottom: -1px; left: 0; right: 0; height: 42px; background: linear-gradient(
    to bottom, 
    rgba(255,249,229,0), 
    rgba(255,249,229,1)
  ); pointer-events: none; z-index: 5; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;}

.collapsible-container .ellipsis {position: absolute; bottom: 8px; width: 100%; text-align: center; color: #888; font-size: 18px; font-weight: bold; z-index: 6;}

.collapsible-container.expanded .fade-overlay {display: none;}

.collapsible-container.expanded .ellipsis {display: none;}

/* Estilos para la tabla de contenidos */

/* Contenedor principal */
#table-of-contents {background-color: #f0f0ff; border-radius: 8px; padding: 20px 30px; margin: 20px 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); font-family: Arial, sans-serif; border: 1px solid #d0d0ff;}

/* Título de la tabla de contenidos */
#contents-header {text-align: center; color: #585b9e; font-size: 24px; margin-top: 10px; margin-bottom: 20px; font-weight: 500; padding-bottom: 15px;}

/* Listas */
ul.toc {list-style-type: none; padding-left: 20px; margin: 0;}

/* Elementos de la lista */
li.toc {margin: 10px 0; line-height: 1.5; color: #585b9e;}

/* Enlaces */
a.toc {text-decoration: none; color: #585b9e; transition: color 0.2s, padding-left 0.2s; display: inline-block;}

/* Efecto hover en los enlaces */
a.toc:hover {color: #3333cc; padding-left: 3px; font-weight: 500; text-decoration: none;}

/* Diferentes niveles de indentación */
li.toc li.toc {margin-left: 15px;}

li.toc li.toc li.toc {margin-left: 25px;}

/* Hacer que los enlaces de primer nivel tengan un poco más de peso */
ul.toc &gt; li.toc &gt; a.toc {font-weight: 500;}

/* Línea decorativa sobre la tabla de contenidos */
#table-of-contents:before {content: ""; display: block; height: 0px; background-color: #d0d0ff; margin-bottom: 15px;}</textarea>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
    var cssCode = document.getElementById('css-editor').value;
    var style = document.createElement('style');
    style.textContent = cssCode;
    document.head.appendChild(style);
});
  </script>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
    // Aplicar estilo con retraso de 100ms para superar posibles hojas de estilo heredadas
    setTimeout(function() {
        document.querySelectorAll('.toggle-button').forEach(btn => {
            btn.style.setProperty('color', 'black', 'important');
            if (!btn.textContent.trim()) {
                btn.textContent = '+';
            }
        });
        document.querySelectorAll('.copy-button').forEach(btn => {
            btn.style.setProperty('color', 'black', 'important');
        });
    }, 1000);
});
  </script>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
(function() {
  function initCollapsibles() {
    // Esperar un poco para que los estilos se apliquen
    setTimeout(() => {
      document.querySelectorAll('.collapsible-container').forEach(container => {
        const pre = container.querySelector('pre');
        if (!pre) return;
        
        const maxLines = parseInt(container.dataset.maxLines, 10) || 6;
        
        // Crear un elemento temporal para medir line-height
        const tempSpan = document.createElement('span');
        tempSpan.style.visibility = 'hidden';
        tempSpan.style.position = 'absolute';
        tempSpan.style.fontSize = getComputedStyle(pre).fontSize;
        tempSpan.style.fontFamily = getComputedStyle(pre).fontFamily;
        tempSpan.style.lineHeight = '1.4';
        tempSpan.textContent = 'M';
        document.body.appendChild(tempSpan);
        
        const lineHeight = tempSpan.offsetHeight;
        document.body.removeChild(tempSpan);
        
        const fullHeight = pre.scrollHeight;
        const collapsedHeight = Math.ceil(lineHeight * maxLines);
        
        console.log('Debug:', {
          maxLines,
          lineHeight,
          fullHeight,
          collapsedHeight,
          shouldCollapse: fullHeight > collapsedHeight + 10
        });
        
        // Solo colapsar si realmente es necesario
        if (fullHeight <= collapsedHeight + 10) {
          return;
        }

        // Estado inicial: colapsado
        container.style.maxHeight = collapsedHeight + 'px';
        container.classList.add('collapsed');

         // === Aquí agregamos primero el botón de "copiar" ===
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-button';
        copyBtn.innerHTML = '📋';
        copyBtn.title = 'Copiar código';
        container.appendChild(copyBtn);

        // Evento para copiar el texto del <pre> al portapapeles
        copyBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          // Copiar el contenido de 'pre'
          const codeText = pre.innerText;
          navigator.clipboard.writeText(codeText).then(() => {
            // Opcional: retroalimentación breve (por ejemplo cambiar texto o color)
            copyBtn.textContent = '✔';
            setTimeout(() => { copyBtn.innerHTML = '📋'; }, 1000);
          }).catch(err => {
            console.error('Error al copiar al portapapeles:', err);
          });
        });

        // Crear botón
        const btn = document.createElement('button');
        btn.className = 'toggle-button';
        btn.textContent = '+';
        btn.title = 'Expandir/Colapsar código';
        container.appendChild(btn);

        // Crear overlay y ellipsis
        const overlay = document.createElement('div');
        overlay.className = 'fade-overlay';
        container.appendChild(overlay);
        
        const ell = document.createElement('div');
        ell.className = 'ellipsis';
        ell.textContent = '...';
        container.appendChild(ell);

        // Evento toggle
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const isCollapsed = container.classList.contains('collapsed');
          
          if (isCollapsed) {
            // Expandir
            container.style.maxHeight = fullHeight + 20 + 'px';
            container.classList.remove('collapsed');
            container.classList.add('expanded');
            btn.textContent = '−';
          } else {
            // Colapsar
            container.style.maxHeight = collapsedHeight + 'px';
            container.classList.add('collapsed');
            container.classList.remove('expanded');
            btn.textContent = '+';
          }
        });
      });
    }, 100); // Esperar 100ms para que se apliquen los estilos
  }
  
  // Múltiples puntos de inicialización para mayor compatibilidad
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCollapsibles);
  } else {
    initCollapsibles();
  }
  
  // También inicializar en window.load por si acaso
  window.addEventListener('load', initCollapsibles);
})();
});
  </script>
 </body>
</html>
